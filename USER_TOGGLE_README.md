# نظام تفعيل/إلغاء تفعيل المستخدمين

## الميزات المضافة

### 1. التبديل (سويتش) للمستخدمين
- **الموقع**: صفحة قائمة المستخدمين (`/admin/users`)
- **الوظيفة**: تمكن الإدارة من تفعيل أو إلغاء تفعيل المستخدمين بسهولة
- **التفاعل**: 
  - نقرة واحدة على التبديل
  - رسالة تأكيد قبل التطبيق
  - تحديث فوري للواجهة
  - رسائل نجاح/خطأ

### 2. الفلترة المحسنة
- **فلتر الحالة النشطة**: تصفية المستخدمين حسب حالة التفعيل (نشط/غير نشط)
- **فلتر الحالة العامة**: تصفية حسب الحالة (فعال/معلق/محظور)
- **البحث**: البحث بالاسم والبريد الإلكتروني والهاتف

### 3. حماية النظام
- **منع إلغاء تفعيل الذات**: لا يمكن للمستخدم إلغاء تفعيل حسابه
- **Middleware حماية**: منع المستخدمين غير المفعلين من الوصول للنظام
- **رسائل خطأ واضحة**: إعلام المستخدمين بحالة حسابهم

## الملفات المحدثة

### 1. واجهة المستخدم
- `resources/views/admin/pages/users/index.blade.php`
  - إضافة عمود الحالة النشطة
  - إضافة التبديل (سويتش)
  - إضافة فلتر الحالة النشطة
  - إضافة JavaScript للتفاعل

### 2. التحكم
- `app/Http/Controllers/Admin/UserController.php`
  - دالة `toggleStatus()` لتبديل الحالة
  - تحديث دالة `index()` لإضافة فلتر `is_active`

### 3. المسارات
- `routes/web.php`
  - إضافة مسار `POST /users/{id}/toggle-status`

### 4. الأمان
- `app/Http/Middleware/CheckUserActive.php`
  - middleware للتحقق من حالة المستخدم
- `app/Http/Controllers/Auth/AuthenticatedSessionController.php`
  - التحقق من الحالة عند تسجيل الدخول

### 5. التخطيط
- `resources/views/admin/layouts/master.blade.php`
  - إضافة CSRF token للطلبات AJAX

## كيفية الاستخدام

### 1. تفعيل/إلغاء تفعيل مستخدم
1. انتقل إلى صفحة قائمة المستخدمين
2. ابحث عن المستخدم المطلوب
3. انقر على التبديل في عمود "الحالة النشطة"
4. أكد العملية في النافذة المنبثقة
5. ستظهر رسالة نجاح أو خطأ

### 2. فلترة المستخدمين
1. استخدم قائمة "كل الحالات النشطة" لتصفية حسب التفعيل
2. استخدم قائمة "كل الحالات" لتصفية حسب الحالة العامة
3. استخدم حقل البحث للبحث بالاسم أو البريد أو الهاتف

### 3. حماية النظام
- المستخدمون غير المفعلين لا يمكنهم تسجيل الدخول
- سيتم إظهار رسالة خطأ واضحة لهم
- المستخدمون المفعلون يمكنهم الوصول للنظام كالمعتاد

## الأمان

### 1. حماية CSRF
- جميع الطلبات محمية بـ CSRF token
- الطلبات AJAX تتضمن token في الـ headers

### 2. التحقق من الصلاحيات
- التحقق من وجود المستخدم قبل التحديث
- منع إلغاء تفعيل الحساب الشخصي

### 3. معالجة الأخطاء
- رسائل خطأ واضحة للمستخدم
- تسجيل الأخطاء في النظام
- إرجاع التبديل لحالته السابقة في حالة الخطأ

## التقنيات المستخدمة

- **Frontend**: JavaScript, Bootstrap, AJAX
- **Backend**: Laravel, Eloquent ORM
- **Security**: CSRF Protection, Middleware
- **UI/UX**: Responsive Design, Real-time Updates

## ملاحظات مهمة

1. **النسخ الاحتياطي**: تأكد من عمل نسخة احتياطية قبل التطبيق
2. **الاختبار**: اختبر النظام على بيئة التطوير أولاً
3. **التوثيق**: وثق أي تغييرات إضافية
4. **الأمان**: راقب سجلات النظام للتأكد من عدم وجود محاولات اختراق 